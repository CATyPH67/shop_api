# Shop API  

Backend интернет-магазина “Меха и шубы”, реализованное на **FastAPI** с использованием **PostgreSQL** и **SQLAlchemy (ORM)**.  

## Функционал  

- Авторизация и регистрация пользователей (в том числе через Яндекс OAuth); 
- Категории товаров с поддержкой вложенности;
- Получение списка товаров по категориям, фильтрация и сортировка по цене. Используйте **price_asc** или **price_desc** в sort;  
- Получение данных товара с названием, описанием, ссылкой на изображение, ценой, размером и категориями;  
- Работа с корзиной: добавление, изменение, удаление и получение содержимого корзины (каждый пользователь видит только свою);  
- Создание заказов с очисткой корзины;  
- SMTP-клиент для отправки писем (после успешного заказа и при регистрации через яндекс, для получения пароля).  

## Технологии  

- **FastAPI** - фреймворк для backend;
- **Pydantic** - валидация данных;   
- **PostgreSQL** - база данных;  
- **SQLAlchemy + Alembic** - ORM и миграции;  
- **Docker** - контейнеризация;  
- **pgAdmin** - удобная работа с БД;  
- **Authlib** - интеграция OAuth (Яндекс);  
- **fastapi_mail** - SMTP-клиент.  

## Запуск приложения  

1. Создайте файл `.env` по примеру `.env.example` и укажите свои параметры.  

2. Выполните команды:  
```bash
docker compose up -d --build
docker compose exec backend alembic upgrade head      # миграции для базы данных
docker compose exec backend python seed_db.py         # создание тестовых данных
```
3. После запуска:

- API доступно по адресу: http://localhost:8000
- Swagger UI доступен по адресу: http://localhost:8000/docs
- ReDoc доступен по адресу: http://localhost:8000/redoc

## Работа с базой данных

pgAdmin доступен по адресу http://localhost:8080

- Логин: admin@example.com
- Пароль: admin

Добавьте новый сервер:

- General -> Name: shop_db
- Connection -> Host: db
- Connection -> Port: 5432
- Connection -> Username: postgres
- Connection -> Password: postgres

## SMTP клиент для отправки сообщений

Можно протестировать с помощью MailHog по адрессу http://localhost:8025.

Новое письмо приходит на почту пользователя после успешного создания заказа, а так же при первой авторизации через яндекс, чтобы пользователь мог получить свой пароль для стандартного входа.

## Авторизация через Yandex

Пройдите по ссылке http://localhost:8000/auth/yandex/login. Вам предложат авторизоваться через аккаунт яндекс. 

При первом входе создаётся учётная запись с логином и почтой (пароль генерируется и отправляется на почту).

После успешной авторизации сервер вернет JWT токен.

